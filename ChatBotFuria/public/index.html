<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="ChatBot da FURIA" />
    <meta name="author" content="FURIA" />
    <title>FURIA ChatBot - A Pantera Responde</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Chat Container -->
    <div class="chat-container">
      <div class="chat-header">
        <img src="imgs/logo.png" alt="Logo FURIA" class="logo" />
        <span>Furia</span>
      </div>
      <div class="chat-box" id="chatBox" role="log">
        <!-- Mensagem inicial automática será inserida via JS -->
      </div>
      <div class="input-area">
        <input
          type="text"
          id="userInput"
          placeholder="Pergunte alguma coisa..."
          onkeypress="if(event.key === 'Enter') sendMessage()"
          aria-label="Digite sua mensagem"
        />
        <button onclick="sendMessage()" aria-label="Enviar mensagem">
          Enviar
        </button>
      </div>
    </div>

    <script>
      const chatBox = document.getElementById("chatBox");
      let typingIndicator;

      // Função para adicionar mensagens
      function appendMessage(content, sender) {
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${sender}-message`;
        messageDiv.innerHTML =
          sender === "bot" ? `<b>FuriaBot:</b> ${content}` : `${content}`;
        chatBox.appendChild(messageDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      // Animação de digitação do bot
      function animateBotMessage(text) {
        const messageDiv = document.createElement("div");
        messageDiv.className = "message bot-message";
        messageDiv.innerHTML = `<b>FuriaBot:</b> `;
        chatBox.appendChild(messageDiv);
        chatBox.scrollTop = chatBox.scrollHeight;

        let i = 0;
        const interval = setInterval(() => {
          if (i < text.length) {
            messageDiv.innerHTML += text.charAt(i);
            chatBox.scrollTop = chatBox.scrollHeight;
            i++;
          } else {
            clearInterval(interval);
          }
        }, 30);
      }

      // Enviar mensagem do usuário
      function sendMessage() {
        const input = document.getElementById("userInput");
        const message = input.value.trim();

        if (!message) return;

        appendMessage(message, "user");

        typingIndicator = document.createElement("div");
        typingIndicator.className = "message bot-message typing";
        typingIndicator.innerHTML = `<b>FuriaBot:</b> Digitando...`;
        chatBox.appendChild(typingIndicator);
        chatBox.scrollTop = chatBox.scrollHeight;

        fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message }),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Erro na resposta da API");
            }
            return response.json();
          })
          .then((data) => {
            chatBox.removeChild(typingIndicator);
            if (data.response) {
              animateBotMessage(data.response);
            } else {
              throw new Error("Resposta vazia da API.");
            }
          })
          .catch((error) => {
            console.error("Erro no fetch:", error);
            chatBox.removeChild(typingIndicator);
            appendMessage("Desculpe, algo deu errado. Tente novamente.", "bot");
          });

        input.value = "";
      }

      // Mensagem automática ao abrir o chat
      window.addEventListener("DOMContentLoaded", () => {
        setTimeout(() => {
          animateBotMessage("E aí, lenda! Eu sou a Pantera da FURIA. Preparado pra trocar ideia ou tirar dúvidas? Manda ver!");
        }, 400);
      });
    </script>
  </body>
</html>
