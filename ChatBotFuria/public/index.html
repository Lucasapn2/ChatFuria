<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="ChatBot da FURIA" />
    <meta name="author" content="FURIA" />
    <title>FURIA ChatBot - A Pantera Responde</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Chat Container -->
    <div class="chat-container">
      <div class="chat-header">
        <img src="imgs/logo.png" alt="Logo FURIA" class="logo" />
        <span>Furia</span>
      </div>
      <div class="chat-box" id="chatBox" role="log">
        <div class="message bot-message">
          <b>FuriaBot:</b> Ol√°! Seja bem-vindo üëã Como posso te ajudar hoje?
        </div>
      </div>
      <div class="input-area">
        <input
          type="text"
          id="userInput"
          placeholder="Pergunte alguma coisa..."
          onkeypress="if(event.key === 'Enter') sendMessage()"
          aria-label="Digite sua mensagem"
        />
        <button onclick="sendMessage()" aria-label="Enviar mensagem">
          Enviar
        </button>
      </div>
    </div>

    <script>
      const chatBox = document.getElementById("chatBox");
      let typingIndicator;

      // Fun√ß√£o para adicionar mensagens na tela
      function appendMessage(content, sender) {
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${sender}-message`;
        messageDiv.innerHTML =
          sender === "bot" ? `<b>FuriaBot:</b> ${content}` : `${content}`;
        chatBox.appendChild(messageDiv);
        chatBox.scrollTop = chatBox.scrollHeight; // Rola at√© o final
      }

      // Fun√ß√£o para enviar a mensagem
      function sendMessage() {
        const input = document.getElementById("userInput");
        const message = input.value.trim();

        if (!message) return; // Evitar envio de mensagens vazias

        appendMessage(message, "user"); // Adiciona mensagem do usu√°rio

        // Mostra "digitando..."
        typingIndicator = document.createElement("div");
        typingIndicator.className = "message bot-message typing";
        typingIndicator.innerHTML = `<b>FuriaBot:</b> Digitando...`;
        chatBox.appendChild(typingIndicator);
        chatBox.scrollTop = chatBox.scrollHeight;

        // Faz a requisi√ß√£o para a fun√ß√£o serverless na Vercel
        fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message }),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Erro na resposta da API");
            }
            return response.json();
          })
          .then((data) => {
            chatBox.removeChild(typingIndicator); // Remove "digitando..."
            if (data.response) {
              appendMessage(data.response, "bot"); // Adiciona resposta do bot
            } else {
              throw new Error("Resposta vazia da API.");
            }
          })
          .catch((error) => {
            console.error("Erro no fetch:", error);
            chatBox.removeChild(typingIndicator); // Remove "digitando..."
            appendMessage("Desculpe, algo deu errado. Tente novamente.", "bot");
          });

        input.value = ""; // Limpa o campo de input ap√≥s enviar a mensagem
      }
    </script>
  </body>
</html>
